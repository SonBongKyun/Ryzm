<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ryzm Terminal ‚Äî Cyberpunk Bloomberg</title>
  <meta name="description"
    content="Ryzm Terminal: Professional cryptocurrency trading dashboard with cyberpunk Bloomberg aesthetics" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&display=swap"
    rel="stylesheet" />

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@0.344.0/dist/umd/lucide.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.6/Sortable.min.js"></script>
  <!-- TradingView Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

  <!-- App Styles -->
  <link rel="stylesheet" href="/static/styles.css?v=3.8" />
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#06b6d4" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
</head>

<body>
  <canvas id="matrix-bg"></canvas>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HEADER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <header class="header">
    <!-- Logo -->
    <div class="logo">
      <span class="logo-dot"></span>
      Ryzm_OS
      <span class="pro-badge">PRO</span>
    </div>

    <!-- BGM Player (v2) -->
    <div class="bgm-player" id="bgm-player">
      <!-- Playback controls -->
      <div class="bgm-controls">
        <button id="bgm-prev" title="Previous" class="bgm-btn bgm-btn-sm">
          <i data-lucide="skip-back" style="width:11px;height:11px;"></i>
        </button>
        <button id="bgm-play" title="Play / Pause" class="bgm-btn bgm-btn-play">
          <i data-lucide="play" style="width:14px;height:14px;"></i>
        </button>
        <button id="bgm-skip" title="Next" class="bgm-btn bgm-btn-sm">
          <i data-lucide="skip-forward" style="width:11px;height:11px;"></i>
        </button>
      </div>
      <!-- Track info + progress -->
      <div class="bgm-info">
        <div class="bgm-info-row">
          <span id="bgm-track-name" class="bgm-track-name">Stopped</span>
          <span id="bgm-time" class="bgm-time">0:00 / 0:00</span>
        </div>
        <div class="bgm-progress-track" id="bgm-progress-track">
          <div class="bgm-progress-fill" id="bgm-progress-fill"></div>
        </div>
      </div>
      <!-- Volume -->
      <div class="bgm-vol-group">
        <button id="bgm-mute" class="bgm-btn bgm-btn-sm" title="Mute" aria-label="Toggle mute">
          <i data-lucide="volume-2" style="width:12px;height:12px;"></i>
        </button>
        <input type="range" id="bgm-volume" class="volume-slider" min="0" max="100" value="60" />
      </div>
      <!-- Playlist toggle -->
      <button id="bgm-list-toggle" class="bgm-btn bgm-btn-sm" title="Playlist">
        <i data-lucide="list-music" style="width:12px;height:12px;"></i>
      </button>
      <!-- Playlist dropdown -->
      <div class="bgm-playlist" id="bgm-playlist" style="display:none;"></div>
    </div>

    <!-- Dark Mode Toggle -->
    <button id="theme-toggle" class="theme-toggle" title="Toggle Dark Mode" aria-label="Toggle dark mode">
      <i data-lucide="moon" style="width:16px;height:16px;"></i>
    </button>

    <!-- Language Toggle (i18n) -->
    <button id="lang-toggle" class="lang-toggle" title="ÌïúÍµ≠Ïñ¥/English" aria-label="Switch language">
      <span id="lang-label">EN</span>
    </button>

    <!-- Auth Button -->
    <button id="btn-auth" class="auth-btn" title="Login / Register" onclick="toggleAuthModal()">
      <i data-lucide="user" style="width:14px;height:14px;"></i>
      <span id="auth-label">Login</span>
    </button>
    <span id="header-plan-badge" class="header-plan-badge" style="display:none;font-size:0.6rem;padding:2px 6px;border-radius:3px;cursor:pointer;" onclick="openUpgradeModal('general')">FREE</span>

    <!-- FX Rate -->
    <div class="header-fx" id="header-fx">
      <span class="fx-label">USD/KRW</span>
      <span class="fx-value" id="fx-usdkrw">‚Äî</span>
      <span class="fx-change" id="fx-usdkrw-chg"></span>
      <span class="fx-divider">|</span>
      <span class="fx-label">USD/JPY</span>
      <span class="fx-value" id="fx-usdjpy">‚Äî</span>
      <span class="fx-change" id="fx-usdjpy-chg"></span>
    </div>

    <!-- Dual Clock -->
    <!-- Market Status -->
    <div class="market-status" id="market-status">
      <span class="market-dot" id="mkt-crypto">CRYPTO</span>
      <span class="market-dot" id="mkt-nyse">NYSE</span>
      <span class="market-dot" id="mkt-forex">FOREX</span>
    </div>

    <div class="dual-clock">
      <div class="clock-item">
        <div class="clock-label">Seoul ¬∑ KST</div>
        <div class="clock-time" id="clock-kst">--:--:--</div>
      </div>
      <div class="clock-divider"></div>
      <div class="clock-item">
        <div class="clock-label">New York ¬∑ EST</div>
        <div class="clock-time" id="clock-est">--:--:--</div>
      </div>
    </div>
  </header>

  <!-- Macro Ticker (New) -->
  <div class="macro-ticker-container">
    <div class="ticker-wrapper">
      <div id="macro-ticker" class="ticker-content">
        <span class="ticker-loading">INITIALIZING MARKET DATA FEED...</span>
      </div>
    </div>
  </div>

  <!-- Vibe Bar HUD -->
  <div id="vibe-bar" class="vibe-bar">
    <div class="vibe-label" data-i18n-text="market_vibe">MARKET VIBE:</div>
    <div id="vibe-status" class="vibe-status">LOADING...</div>
    <div id="regime-badge" class="regime-badge">--</div>
    <div class="vibe-divider"></div>
    <div id="vibe-message" class="vibe-marquee">Ryzm System Initializing...</div>
  </div>

  <!-- Section Navigation Bar -->
  <nav class="section-nav" id="section-nav">
    <div class="section-nav-track">
      <a class="snav-item active" data-target="risk-gauge-panel" title="Systemic Risk Gauge"><i data-lucide="shield-alert"></i><span data-i18n-text="snav_risk">Risk</span></a>
      <a class="snav-item" data-target="fg-panel" title="Fear & Greed"><i data-lucide="thermometer"></i><span data-i18n-text="snav_fg">F&G</span></a>
      <a class="snav-item" data-target="mtf-panel-nav" title="Multi-TF"><i data-lucide="layers"></i><span data-i18n-text="snav_mtf">MTF</span></a>
      <span class="snav-sep"></span>
      <a class="snav-item" data-target="council-section" title="Neural Council"><i data-lucide="cpu"></i><span data-i18n-text="snav_council">Council</span></a>
      <a class="snav-item" data-target="chart-panel" title="Chart"><i data-lucide="bar-chart-2"></i><span data-i18n-text="snav_chart">Chart</span></a>
      <a class="snav-item" data-target="validator-panel" title="Trade Validator"><i data-lucide="shield-check"></i><span data-i18n-text="snav_validator">Validator</span></a>
      <a class="snav-item" data-target="council-history-panel" title="AI Tracker"><i data-lucide="brain-circuit"></i><span data-i18n-text="snav_tracker">Tracker</span></a>
      <a class="snav-item" data-target="heatmap-section" title="Heatmap"><i data-lucide="grid-3x3"></i><span data-i18n-text="snav_heatmap">Heatmap</span></a>
      <span class="snav-sep"></span>
      <a class="snav-item" data-target="prices-section" title="Realtime Prices"><i data-lucide="trending-up"></i><span data-i18n-text="snav_prices">Prices</span></a>
      <a class="snav-item" data-target="ls-section" title="Long/Short"><i data-lucide="scale"></i><span data-i18n-text="snav_ls">L/S</span></a>
      <a class="snav-item" data-target="scanner-section" title="Alpha Scanner"><i data-lucide="radar"></i><span data-i18n-text="snav_scanner">Scanner</span></a>
      <a class="snav-item" data-target="whale-section" title="Whale Alert"><i data-lucide="anchor"></i><span data-i18n-text="snav_whale">Whale</span></a>
      <a class="snav-item" data-target="onchain-section" title="On-Chain"><i data-lucide="link"></i><span data-i18n-text="snav_onchain">On-Chain</span></a>
      <a class="snav-item" data-target="news-section" title="Live Wire"><i data-lucide="rss"></i><span data-i18n-text="snav_news">News</span></a>
    </div>
  </nav>

  <!-- Quick Action Toolbar -->
  <div class="quick-actions">
    <div class="tooltip-wrapper">
      <button class="quick-btn" id="btn-refresh-all" title="Refresh All Data">
        <i data-lucide="refresh-cw" style="width:18px;height:18px;"></i>
      </button>
      <span class="tooltip" data-i18n-text="refresh_all">Refresh All</span>
    </div>
    <div class="tooltip-wrapper">
      <button class="quick-btn" id="btn-fullscreen" title="Toggle Fullscreen">
        <i data-lucide="maximize-2" style="width:18px;height:18px;"></i>
      </button>
      <span class="tooltip" data-i18n-text="fullscreen">Fullscreen</span>
    </div>
    <div class="tooltip-wrapper">
      <button class="quick-btn" id="btn-notifications" title="Notification Settings">
        <i data-lucide="bell" style="width:18px;height:18px;"></i>
      </button>
      <span class="tooltip" data-i18n-text="notifications">Notifications</span>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MAIN 3-COLUMN GRID
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main class="main-grid" id="main-grid">

    <div class="panel" id="panel-left" data-panel-id="left">
      <!-- Systemic Risk Gauge v2.0 -->
      <div class="glass-panel risk-gauge-panel" id="risk-gauge-panel" style="flex: 1; position: relative; overflow: hidden;">
        <div class="panel-title" data-i18n="risk_gauge">
          <i data-lucide="shield-alert"></i> Systemic Risk Gauge
          <button class="rg-alert-btn" id="rg-alert-btn" title="Set Alert Threshold"><i data-lucide="bell" style="width:12px;height:12px;"></i></button>
        </div>
        <!-- Alert threshold config (hidden by default) -->
        <div class="rg-alert-config hidden" id="rg-alert-config">
          <label>Alert Threshold</label>
          <input type="range" id="rg-threshold" min="-100" max="100" step="5" value="-50">
          <span class="rg-threshold-val" id="rg-threshold-val">-50</span>
          <button class="rg-alert-save" id="rg-alert-save">SET</button>
        </div>
        <div class="risk-gauge-body">
          <!-- 270¬∞ Arc Gauge SVG -->
          <div class="gauge-container">
            <svg viewBox="0 0 200 200" class="gauge-svg">
              <defs>
                <linearGradient id="gaugeGrad270" x1="0%" y1="100%" x2="100%" y2="0%">
                  <stop offset="0%" stop-color="#dc2626"/>
                  <stop offset="30%" stop-color="#f97316"/>
                  <stop offset="50%" stop-color="#eab308"/>
                  <stop offset="75%" stop-color="#06b6d4"/>
                  <stop offset="100%" stop-color="#059669"/>
                </linearGradient>
                <linearGradient id="gaugeInner270" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" stop-color="white" stop-opacity="0.4"/>
                  <stop offset="100%" stop-color="black" stop-opacity="0.12"/>
                </linearGradient>
                <filter id="gaugeGlow270" x="-20%" y="-20%" width="140%" height="140%">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="3" result="blur"/>
                  <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
                <filter id="needleGlow270" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur"/>
                  <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
                <radialGradient id="hubGrad270" cx="50%" cy="40%" r="50%">
                  <stop offset="0%" stop-color="#1e293b" stop-opacity="1"/>
                  <stop offset="100%" stop-color="#1e293b" stop-opacity="0.4"/>
                </radialGradient>
              </defs>
              <!-- Outer rim -->
              <path d="M 43.43 156.57 A 80 80 0 1 1 156.57 156.57" fill="none" stroke="var(--border-dim)" stroke-width="18" stroke-linecap="round" opacity="0.3"/>
              <!-- Background track -->
              <path d="M 43.43 156.57 A 80 80 0 1 1 156.57 156.57" fill="none" stroke="var(--border-dim)" stroke-width="14" stroke-linecap="round"/>
              <!-- Inner highlight -->
              <path d="M 45.5 154.5 A 77 77 0 1 1 154.5 154.5" fill="none" stroke="url(#gaugeInner270)" stroke-width="10" stroke-linecap="round" opacity="0.4"/>
              <!-- Gradient background arc -->
              <path d="M 43.43 156.57 A 80 80 0 1 1 156.57 156.57" fill="none" stroke="url(#gaugeGrad270)" stroke-width="12" stroke-linecap="round" opacity="0.2"/>
              <!-- Active arc (filled by JS) -->
              <path id="gauge-arc" d="M 43.43 156.57 A 80 80 0 1 1 156.57 156.57" fill="none" stroke="url(#gaugeGrad270)" stroke-width="12" stroke-linecap="round" stroke-dasharray="377" stroke-dashoffset="188" filter="url(#gaugeGlow270)" style="transition: stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1);"/>
              <!-- Tick marks (7 ticks for 270¬∞) -->
              <g stroke="var(--text-muted)" stroke-width="1" opacity="0.35">
                <line x1="43" y1="157" x2="51" y2="151"/>
                <line x1="24" y1="100" x2="34" y2="100"/>
                <line x1="43" y1="43" x2="51" y2="49"/>
                <line x1="100" y1="20" x2="100" y2="30"/>
                <line x1="157" y1="43" x2="149" y2="49"/>
                <line x1="176" y1="100" x2="166" y2="100"/>
                <line x1="157" y1="157" x2="149" y2="151"/>
              </g>
              <!-- Zone labels -->
              <text x="30" y="145" fill="#dc2626" font-size="5.5" font-family="var(--font-head)" text-anchor="middle" opacity="0.7">CRIT</text>
              <text x="20" y="85" fill="#f97316" font-size="5.5" font-family="var(--font-head)" text-anchor="middle" opacity="0.7">HIGH</text>
              <text x="55" y="35" fill="#eab308" font-size="5.5" font-family="var(--font-head)" text-anchor="middle" opacity="0.6">ELEV</text>
              <text x="145" y="35" fill="#06b6d4" font-size="5.5" font-family="var(--font-head)" text-anchor="middle" opacity="0.6">MOD</text>
              <text x="180" y="85" fill="#059669" font-size="5.5" font-family="var(--font-head)" text-anchor="middle" opacity="0.7">LOW</text>
              <!-- Scale labels -->
              <text x="38" y="172" fill="var(--text-muted)" font-size="7" font-family="var(--font-mono)" text-anchor="middle">-100</text>
              <text x="100" y="14" fill="var(--text-muted)" font-size="7" font-family="var(--font-mono)" text-anchor="middle">0</text>
              <text x="162" y="172" fill="var(--text-muted)" font-size="7" font-family="var(--font-mono)" text-anchor="middle">+100</text>
              <!-- Needle -->
              <g id="gauge-needle" transform="rotate(0, 100, 100)" style="transition: transform 1.2s cubic-bezier(0.4,0,0.2,1);">
                <line x1="100" y1="100" x2="100" y2="28" stroke="#334155" stroke-width="3" stroke-linecap="round" opacity="0.2" transform="translate(1,1)"/>
                <line id="needle-line" x1="100" y1="100" x2="100" y2="26" stroke="#1e293b" stroke-width="2.5" stroke-linecap="round" filter="url(#needleGlow270)"/>
              </g>
              <!-- Center hub -->
              <circle cx="100" cy="100" r="9" fill="#1e293b" class="gauge-hub"/>
              <circle cx="98" cy="97" r="3.5" fill="white" opacity="0.3"/>
              <!-- Score & label inside SVG -->
              <text id="gauge-score-svg" x="100" y="130" text-anchor="middle" fill="#1e293b" font-size="18" font-family="var(--font-mono)" font-weight="900">0</text>
              <text id="gauge-label-svg" x="100" y="143" text-anchor="middle" fill="#1e293b" font-size="6.5" font-family="var(--font-head)" letter-spacing="1.5px">[LOADING]</text>
              <!-- Alert threshold line (hidden by default) -->
              <line id="gauge-threshold-line" x1="100" y1="100" x2="100" y2="30" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4 2" opacity="0" style="transition: opacity 0.3s;"/>
            </svg>
            <!-- AI Commentary -->
            <div class="rg-commentary" id="rg-commentary"></div>
            <!-- Delta indicator -->
            <div class="gauge-delta" id="risk-delta"></div>
          </div>

          <!-- Tabbed sections -->
          <div class="rg-tabs" id="rg-tabs">
            <button class="rg-tab active" data-rgtab="components"><i data-lucide="bar-chart-3" style="width:10px;height:10px;"></i> Comp</button>
            <button class="rg-tab" data-rgtab="radar"><i data-lucide="radar" style="width:10px;height:10px;"></i> Radar</button>
            <button class="rg-tab" data-rgtab="heatmap"><i data-lucide="grid-3x3" style="width:10px;height:10px;"></i> Œî Map</button>
            <button class="rg-tab" data-rgtab="corr"><i data-lucide="link" style="width:10px;height:10px;"></i> Corr</button>
            <button class="rg-tab" data-rgtab="sim"><i data-lucide="sliders-horizontal" style="width:10px;height:10px;"></i> Sim</button>
          </div>

          <!-- Tab: Components with sparklines -->
          <div class="rg-tab-content active" id="rg-tab-components">
            <div class="risk-components-v2" id="risk-components">
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_sentiment">SENTIMENT</span><canvas class="rc-spark" id="rc-spark-fg" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-fg-bar"></div></div><span class="rc-value" id="rc-fg">‚Äî</span></div>
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_volatility">VOLATILITY</span><canvas class="rc-spark" id="rc-spark-vix" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-vix-bar"></div></div><span class="rc-value" id="rc-vix">‚Äî</span></div>
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_leverage">LEVERAGE</span><canvas class="rc-spark" id="rc-spark-ls" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-ls-bar"></div></div><span class="rc-value" id="rc-ls">‚Äî</span></div>
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_funding">FUNDING</span><canvas class="rc-spark" id="rc-spark-fr" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-fr-bar"></div></div><span class="rc-value" id="rc-fr">‚Äî</span></div>
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_kimchi">KIMCHI P.</span><canvas class="rc-spark" id="rc-spark-kp" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-kp-bar"></div></div><span class="rc-value" id="rc-kp">‚Äî</span></div>
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_oi">OI</span><canvas class="rc-spark" id="rc-spark-oi" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-oi-bar"></div></div><span class="rc-value" id="rc-oi">‚Äî</span></div>
              <div class="rc-row"><span class="rc-label" data-i18n-text="rc_stablecoin">USDT DOM</span><canvas class="rc-spark" id="rc-spark-sc" width="40" height="16"></canvas><div class="rc-bar-track"><div class="rc-bar-fill" id="rc-sc-bar"></div></div><span class="rc-value" id="rc-sc">‚Äî</span></div>
            </div>
          </div>

          <!-- Tab: Radar Chart -->
          <div class="rg-tab-content" id="rg-tab-radar">
            <svg id="rg-radar-svg" viewBox="0 0 200 200" class="rg-radar-canvas"></svg>
          </div>

          <!-- Tab: Change Rate Heatmap -->
          <div class="rg-tab-content" id="rg-tab-heatmap">
            <table class="rg-heatmap-table" id="rg-heatmap-table">
              <thead><tr><th></th><th>1H</th><th>4H</th><th>24H</th></tr></thead>
              <tbody id="rg-heatmap-body"></tbody>
            </table>
          </div>

          <!-- Tab: Correlation Matrix -->
          <div class="rg-tab-content" id="rg-tab-corr">
            <div class="rg-corr-matrix" id="rg-corr-matrix">
              <div class="rg-corr-loading">Loading correlation data...</div>
            </div>
          </div>

          <!-- Tab: Scenario Simulator -->
          <div class="rg-tab-content" id="rg-tab-sim">
            <div class="rg-simulator" id="rg-simulator">
              <div class="rg-sim-row"><label>Fear/Greed</label><input type="range" class="rg-sim-slider" id="sim-fg" min="0" max="100" value="50"><span id="sim-fg-val">50</span></div>
              <div class="rg-sim-row"><label>VIX</label><input type="range" class="rg-sim-slider" id="sim-vix" min="10" max="80" value="20"><span id="sim-vix-val">20</span></div>
              <div class="rg-sim-row"><label>Long %</label><input type="range" class="rg-sim-slider" id="sim-ls" min="30" max="70" value="50"><span id="sim-ls-val">50</span></div>
              <div class="rg-sim-row"><label>Fund Rate</label><input type="range" class="rg-sim-slider" id="sim-fr" min="-0.1" max="0.1" step="0.005" value="0"><span id="sim-fr-val">0</span></div>
              <div class="rg-sim-row"><label>Kimchi %</label><input type="range" class="rg-sim-slider" id="sim-kp" min="-5" max="10" step="0.5" value="0"><span id="sim-kp-val">0</span></div>
              <div class="rg-sim-row"><label>OI (B$)</label><input type="range" class="rg-sim-slider" id="sim-oi" min="10" max="50" value="20"><span id="sim-oi-val">20</span></div>
              <div class="rg-sim-row"><label>USDT Dom%</label><input type="range" class="rg-sim-slider" id="sim-sc" min="2" max="12" step="0.5" value="5"><span id="sim-sc-val">5</span></div>
              <div class="rg-sim-result" id="rg-sim-result">
                <span class="rg-sim-score" id="rg-sim-score">0</span>
                <span class="rg-sim-label" id="rg-sim-label">MODERATE</span>
              </div>
            </div>
          </div>

          <div class="gauge-timestamp" id="gauge-timestamp"></div>
        </div>
        <!-- Risk History Chart + Zone Timeline + Price Overlay -->
        <div class="risk-history-chart" id="risk-history-section">
          <div class="risk-history-header">
            <span class="risk-history-title"><i data-lucide="trending-up" style="width:12px;height:12px;"></i> RISK INDEX (30D)</span>
            <span class="risk-history-range" id="risk-history-range">‚Äî</span>
            <button class="rg-overlay-btn" id="rg-price-overlay-btn" title="Toggle BTC Price Overlay"><i data-lucide="layers" style="width:11px;height:11px;"></i></button>
          </div>
          <canvas id="risk-history-canvas" width="320" height="100" style="width:100%;height:100px;cursor:crosshair;"></canvas>
          <div class="rg-chart-tooltip hidden" id="rg-chart-tooltip"></div>
          <div class="rg-zone-timeline" id="rg-zone-timeline"></div>
        </div>
      </div>

      <!-- Museum of Scars -->
      <div class="glass-panel" style="flex: 1; min-height: 140px; position: relative;">
        <div class="panel-title" data-i18n="museum_scars"><i data-lucide="skull"></i> Museum of Scars <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
        <div id="scars-feed" style="overflow-y:auto; max-height: 200px; font-size:0.72rem;">
          <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div><div class="skeleton skeleton-line short"></div></div>
        </div>
        </div>
      </div>

      <!-- Fear & Greed 30-Day Chart -->
      <div class="glass-panel fg-chart-panel" id="fg-panel" style="min-height:160px;">
        <div class="panel-title" data-i18n="fg_chart"><i data-lucide="thermometer"></i> Fear & Greed (30D) <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div class="fg-header">
            <span class="fg-score-big" id="fg-score-big">‚Äî</span>
            <span class="fg-label-big" id="fg-label-big">Loading...</span>
          </div>
          <canvas id="fg-canvas" width="320" height="90" style="width:100%;height:90px;"></canvas>
        </div>
      </div>

      <!-- Multi-Timeframe Analysis -->
      <div class="glass-panel mtf-panel" id="mtf-panel-nav" style="min-height:160px;">
        <div class="panel-title" data-i18n="mtf_analysis"><i data-lucide="layers"></i> Multi-TF Analysis <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div class="mtf-symbol" id="mtf-symbol">BTC/USDT</div>
          <table class="mtf-table" id="mtf-table">
            <thead>
              <tr><th>TF</th><th>RSI</th><th>EMA</th><th>Signal</th></tr>
            </thead>
            <tbody id="mtf-tbody">
              <tr><td colspan="4" style="text-align:center;color:var(--text-muted);">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="glass-panel" style="height: 120px; min-height:120px;">
        <div class="panel-title" data-i18n="kimchi_premium"><i data-lucide="flame"></i> Kimchi Premium</div>
        <div class="kp-gauge">
          <div class="kp-value" id="kp-value" style="font-size:1.5rem; font-family:var(--font-mono); color:var(--neon-green);">+3.42%
          </div>
          <div id="kp-status" style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Arb Opportunity: LOW</div>
          <div style="font-size:0.6rem; color:var(--text-tertiary); margin-top:3px;">updated <span id="kp-updated">--:--</span></div>
        </div>
      </div>

      <!-- Economic Calendar -->
      <div class="glass-panel" style="height: 150px; min-height:150px;">
        <div class="panel-title" data-i18n="econ_calendar"><i data-lucide="calendar"></i> Economic Calendar <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
        <div id="calendar-feed" style="overflow-y:auto; max-height:105px; font-size:0.72rem;">
          <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div><div class="skeleton skeleton-line short"></div></div>
        </div>
        </div>
      </div>
    </div>

    <div class="center-panel" id="panel-center" data-panel-id="center">

      <div class="council-container" id="council-section">
        <div class="council-header">
          <span class="council-label">/// NEURAL_COUNCIL</span>
          <span id="consensus-score" class="council-score">SCORE: --</span>
        </div>
        <!-- Edge Summary -->
        <div class="edge-summary" id="edge-summary" style="display:none;">
          <span class="edge-badge" id="edge-badge">EDGE: ‚Äî</span>
          <span class="edge-agreement" id="edge-agreement"></span>
        </div>
        <div class="agents-grid" id="agents-grid">
          <div class="agent-card">
            <div class="agent-icon">R</div>
            <div class="agent-name">SYSTEM</div>
            <div class="agent-msg">Standby...</div>
          </div>
        </div>
      </div>

      <div class="glass-panel chart-container" id="chart-panel"
        style="height:500px; padding:0; border:1px solid var(--border-bright); overflow:hidden;">
        <!-- Symbol Tabs + Intervals -->
        <div class="chart-header">
          <div class="chart-tabs" id="chart-tabs">
            <button class="chart-tab active" data-binance="BTCUSDT" data-name="BTC/USDT"><span class="tab-label">BTC</span><span class="tab-price"></span></button>
            <button class="chart-tab" data-binance="ETHUSDT" data-name="ETH/USDT"><span class="tab-label">ETH</span><span class="tab-price"></span></button>
            <button class="chart-tab" data-binance="SOLUSDT" data-name="SOL/USDT"><span class="tab-label">SOL</span><span class="tab-price"></span></button>
            <button class="chart-tab" data-binance="XRPUSDT" data-name="XRP/USDT"><span class="tab-label">XRP</span><span class="tab-price"></span></button>
          </div>
          <div class="chart-intervals" id="chart-intervals">
            <button class="interval-btn" data-interval="1m">1m</button>
            <button class="interval-btn" data-interval="5m">5m</button>
            <button class="interval-btn" data-interval="15m">15m</button>
            <button class="interval-btn active" data-interval="1H">1H</button>
            <button class="interval-btn" data-interval="4H">4H</button>
            <button class="interval-btn" data-interval="1D">1D</button>
            <button class="interval-btn" data-interval="1W">1W</button>
          </div>
        </div>
        <!-- Chart Toolbar -->
        <div class="chart-toolbar" id="chart-toolbar">
          <!-- Indicators -->
          <div class="toolbar-group">
            <button class="ind-toggle active" data-ind="ema" title="EMA 7/25/99">EMA</button>
            <button class="ind-toggle" data-ind="bb" title="Bollinger Bands (20,2)">BB</button>
            <button class="ind-toggle" data-ind="rsi" title="RSI (14)">RSI</button>
            <button class="ind-toggle" data-ind="macd" title="MACD (12,26,9)">MACD</button>
            <button class="ind-toggle active" data-ind="vol" title="Volume">Vol</button>
            <button class="ind-toggle" data-ind="funding" title="Funding Rate">Fund</button>
            <button class="ind-toggle" data-ind="liqmap" title="Liquidation Map">Liq</button>
            <button class="ind-toggle" data-ind="depth" title="Order Book Depth">Depth</button>
          </div>
          <div class="toolbar-divider"></div>
          <!-- Drawing Tools -->
          <div class="toolbar-group">
            <button class="draw-tool-btn" data-tool="hline" title="Horizontal Line">‚îÄ</button>
            <button class="draw-tool-btn" data-tool="trendline" title="Trend Line">‚ï±</button>
            <button class="draw-tool-btn" data-tool="fib" title="Fibonacci">Fib</button>
            <button class="draw-tool-btn draw-clear" data-tool="clear" title="Clear Drawings">‚úï</button>
          </div>
          <div class="toolbar-divider"></div>
          <!-- Layout -->
          <div class="toolbar-group">
            <button class="layout-btn active" data-layout="1x1" title="Single Chart">‚òê</button>
            <button class="layout-btn" data-layout="2x2" title="4-Chart Grid">‚äû</button>
          </div>
          <div class="toolbar-divider"></div>
          <!-- Actions -->
          <div class="toolbar-group">
            <button class="toolbar-action-btn" id="btn-chart-signals" title="AI Signal Markers">ü§ñ</button>
            <button class="toolbar-action-btn" id="btn-chart-journal" title="Journal on Chart">üìì</button>
            <button class="toolbar-action-btn" id="btn-chart-snapshot" title="Snapshot">üì∏</button>
            <select class="comp-select" id="comp-select" title="Compare Symbol">
              <option value="">Compare</option>
              <option value="ETHUSDT">ETH</option>
              <option value="SOLUSDT">SOL</option>
              <option value="XRPUSDT">XRP</option>
              <option value="BTCUSDT">BTC</option>
              <option value="DOGEUSDT">DOGE</option>
              <option value="BNBUSDT">BNB</option>
            </select>
          </div>
        </div>
        <!-- OHLCV Legend -->
        <div class="ryzm-chart-legend" id="ryzm-chart-legend"></div>
        <!-- Chart Body (flex container) -->
        <div class="chart-body">
          <!-- Chart Layout Wrapper -->
          <div id="chart-layout-wrapper" class="chart-layout-1x1">
            <div id="ryzm-chart-container" style="height:100%; width:100%;"></div>
          </div>
          <!-- RSI Sub-chart Container -->
          <div id="ryzm-rsi-container" class="chart-sub"></div>
          <!-- Depth Sub-chart Container -->
          <div id="ryzm-depth-container" class="chart-sub"></div>
        </div>
      </div>

      <button class="ai-scan-btn" id="btn-council-start">
        <i data-lucide="zap"></i> <span data-i18n-text="execute_analysis">EXECUTE ANALYSIS PROTOCOL</span>
      </button>

      <button id="btn-copy-report" class="ai-scan-btn secondary-btn"
        style="display:none; margin-top:10px; background:var(--bg-panel); border:1px solid var(--neon-magenta); color:var(--neon-magenta);">
        <i data-lucide="copy"></i> <span data-i18n-text="copy_report">COPY REPORT FOR X</span>
      </button>

      <!-- Strategic Narrative -->
      <div id="strategic-narrative" class="strategic-narrative" style="display:none;">
        <div class="sn-header" data-i18n-text="strategic_narrative">
          <i data-lucide="layers" style="width:14px;height:14px;"></i> STRATEGIC NARRATIVE
        </div>
        <div id="sn-layers"></div>
      </div>

      <button id="btn-snapshot" class="ai-scan-btn secondary-btn" style="margin-top:10px; background:#333; color:#fff;">
        <i data-lucide="camera"></i> <span data-i18n-text="export_snapshot">EXPORT SNAPSHOT</span>
      </button>

      <button id="btn-save-journal" class="ai-scan-btn secondary-btn"
        style="display:none; margin-top:10px; background:var(--bg-panel); border:1px solid var(--neon-green); color:var(--neon-green);">
        <i data-lucide="bookmark-plus"></i> SAVE TO JOURNAL
      </button>

      <!-- Trade Validator (P0-1) -->
      <div class="glass-panel validator-panel" id="validator-panel" style="margin-top:12px;">
        <div class="panel-title" data-i18n="trade_validator">
          <i data-lucide="shield-check"></i> Trade Validator
          <span class="val-credits" id="val-credits">3/3 Free</span>
        </div>
        <div class="panel-body">
          <div class="validator-form">
            <input type="text" id="val-symbol" class="val-input" placeholder="Symbol (e.g. BTC)" maxlength="20" />
            <input type="number" id="val-price" class="val-input" placeholder="Entry Price ($)" step="0.01" min="0" />
            <select id="val-position" class="val-input">
              <option value="LONG">LONG</option>
              <option value="SHORT">SHORT</option>
            </select>
            <button id="btn-validate" class="validate-btn">
              <i data-lucide="zap"></i> <span data-i18n-text="validate_trade">VALIDATE TRADE</span>
            </button>
          </div>
          <div id="validator-result" class="validator-result" style="display:none;"></div>
        </div>
      </div>

      <!-- AI Council Prediction History -->
      <div class="glass-panel council-history-panel" id="council-history-panel" style="margin-top:12px;">
        <div class="panel-title" data-i18n="ai_tracker">
          <i data-lucide="brain-circuit"></i> AI Prediction Tracker
          <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i>
        </div>
        <div class="panel-body">
          <div class="ch-stats" id="ch-stats">
            <div class="ch-stat-box">
              <div class="ch-stat-value" id="ch-total">‚Äî</div>
              <div class="ch-stat-label">SESSIONS</div>
            </div>
            <div class="ch-stat-box ch-accuracy">
              <div class="ch-stat-value" id="ch-accuracy">‚Äî</div>
              <div class="ch-stat-label">HIT RATE</div>
            </div>
            <div class="ch-stat-box">
              <div class="ch-stat-value" id="ch-hits">‚Äî</div>
              <div class="ch-stat-label">HITS</div>
            </div>
          </div>
          <!-- Multi-Horizon Accuracy Breakdown -->
          <div class="ch-horizons" id="ch-horizons" style="display:flex;gap:4px;margin:6px 0;font-size:0.65rem;">
            <div class="ch-hz-pill" data-hz="15min"><span class="ch-hz-label">15m</span><span class="ch-hz-val" id="ch-hz-15">‚Äî</span></div>
            <div class="ch-hz-pill" data-hz="60min"><span class="ch-hz-label">1h</span><span class="ch-hz-val" id="ch-hz-60">‚Äî</span></div>
            <div class="ch-hz-pill" data-hz="240min"><span class="ch-hz-label">4h</span><span class="ch-hz-val" id="ch-hz-240">‚Äî</span></div>
            <div class="ch-hz-pill" data-hz="1440min"><span class="ch-hz-label">1d</span><span class="ch-hz-val" id="ch-hz-1440">‚Äî</span></div>
          </div>
          <div class="ch-chart" id="ch-chart">
            <canvas id="ch-canvas" width="400" height="80"></canvas>
          </div>
          <!-- Council Score vs BTC Overlay -->
          <div class="ch-overlay-section" id="ch-overlay-section">
            <div class="ch-overlay-header">
              <span class="ch-overlay-title"><i data-lucide="git-compare" style="width:12px;height:12px;"></i> SCORE vs BTC</span>
            </div>
            <canvas id="ch-overlay-canvas" width="400" height="100" style="width:100%;height:100px;"></canvas>
            <div class="ch-overlay-stats" id="ch-overlay-stats">
              <div class="ch-zone-stat bull">
                <span class="ch-zone-label">BULL ZONE (‚â•70)</span>
                <span class="ch-zone-value" id="ch-bull-avg">‚Äî</span>
              </div>
              <div class="ch-zone-stat bear">
                <span class="ch-zone-label">BEAR ZONE (‚â§30)</span>
                <span class="ch-zone-value" id="ch-bear-avg">‚Äî</span>
              </div>
            </div>
          </div>
          <div class="ch-records" id="ch-records" style="max-height:120px; overflow-y:auto; font-size:0.7rem;">
            <div style="text-align:center; color:var(--text-muted); padding:10px;">Run Council to start tracking...</div>
          </div>
        </div>
      </div>

      <!-- Mini Heatmap -->
      <div class="glass-panel heatmap-panel" id="heatmap-section" style="margin-top:12px;">
        <div class="panel-title" data-i18n="market_heatmap"><i data-lucide="grid-3x3"></i> Market Heatmap (24h)</div>
        <div id="heatmap-grid" class="heatmap-grid">
          <div style="text-align:center; padding:15px; color:var(--text-muted); font-size:0.75rem;">Loading heatmap...</div>
        </div>
      </div>

      <!-- Liquidation Kill Zone -->
      <div class="glass-panel liq-panel" style="margin-top:12px;">
        <div class="panel-title" data-i18n="liq_heatmap"><i data-lucide="target"></i> Liquidation Kill Zone <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div id="liq-zones" style="min-height:80px;">
            <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div></div>
          </div>
        </div>
      </div>

      <!-- Correlation Matrix -->
      <div class="glass-panel corr-panel" style="margin-top:12px;">
        <div class="panel-title" data-i18n="correlation_matrix"><i data-lucide="network"></i> Correlation Matrix (30D) <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div id="corr-matrix" style="min-height:80px;">
            <div class="skeleton-loader"><div class="skeleton skeleton-block"></div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel" id="panel-right" data-panel-id="right">
      <!-- Real-time Price Panel (NEW) -->
      <div class="glass-panel" id="prices-section" style="flex: 1;">
        <div class="panel-title" data-i18n="realtime_prices"><i data-lucide="trending-up"></i> Realtime Prices <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
        <div id="realtime-prices" class="price-panel">
          <div class="skeleton-loader"><div class="skeleton skeleton-block"></div><div class="skeleton skeleton-block"></div><div class="skeleton skeleton-block"></div></div>
        </div>
        </div>
      </div>

      <!-- L/S Ratio Panel -->
      <div class="glass-panel ls-panel" id="ls-section" style="margin-bottom:15px;">
        <div class="panel-title" data-i18n="long_short"><i data-lucide="scale"></i> Long/Short Ratio</div>
        <div class="ls-container">
          <!-- 3D Bar Gauge -->
          <div class="ls-bar-3d">
            <div class="ls-bar-track">
              <div id="ls-long" class="ls-fill long" style="width: 50%;">
                <span class="ls-val">50%</span>
              </div>
              <div id="ls-short" class="ls-fill short" style="width: 50%;">
                <span class="ls-val">50%</span>
              </div>
            </div>
            <div class="ls-bar-shine"></div>
          </div>
          <!-- Percentage indicators -->
          <div class="ls-indicators">
            <div class="ls-indicator long-ind">
              <span class="ls-dot dot-long"></span>
              <span class="ls-ind-label">LONG</span>
              <span class="ls-ind-val" id="ls-long-pct">50%</span>
            </div>
            <div class="ls-indicator">
              <div class="ls-ratio-display" id="ls-ratio-num">1.00</div>
            </div>
            <div class="ls-indicator short-ind">
              <span class="ls-ind-val" id="ls-short-pct">50%</span>
              <span class="ls-ind-label">SHORT</span>
              <span class="ls-dot dot-short"></span>
            </div>
          </div>
          <!-- Funding Rate -->
          <div id="funding-rates" class="funding-rates">
            <span class="fr-label">FUNDING:</span>
            <span id="fr-btc" class="fr-item">BTC ‚Äî</span>
            <span id="fr-eth" class="fr-item">ETH ‚Äî</span>
            <span id="fr-sol" class="fr-item">SOL ‚Äî</span>
          </div>
        </div>
      </div>

      <!-- Alpha Scanner -->
      <div class="glass-panel scanner-panel" id="scanner-section" style="margin-bottom:15px;">
        <div class="panel-title" data-i18n="alpha_scanner"><i data-lucide="radar"></i> Alpha Scanner (15m) <span class="scanner-live-dot"></span> <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
        <div id="scanner-feed" style="min-height:60px; max-height:200px; overflow-y:auto;">
          <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div></div>
        </div>
        </div>
      </div>

      <!-- Price Alerts -->
      <div class="glass-panel" style="margin-bottom:15px;">
        <div class="panel-title"><i data-lucide="bell"></i> Price Alerts <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div id="price-alerts-container" style="min-height:40px;"></div>
        </div>
      </div>

      <!-- Whale Alert Feed -->
      <div class="glass-panel" id="whale-section" style="height: 150px; min-height:150px;">
        <div class="panel-title" data-i18n="whale_alert"><i data-lucide="anchor"></i> Whale Alert <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
        <div id="whale-feed" style="overflow-y:auto; max-height:105px; font-size:0.72rem;">
          <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div></div>
        </div>
        </div>
      </div>

      <!-- Whale Wallet Tracker -->
      <div class="glass-panel whale-wallet-panel" style="min-height:120px;">
        <div class="panel-title" data-i18n="whale_wallets"><i data-lucide="wallet"></i> Whale Wallets (BTC) <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div id="whale-wallet-feed" style="overflow-y:auto; max-height:150px; font-size:0.72rem;">
            <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div></div>
          </div>
        </div>
      </div>

      <!-- On-Chain Radar -->
      <div class="glass-panel onchain-panel" id="onchain-section" style="min-height:180px;">
        <div class="panel-title" data-i18n="onchain_radar"><i data-lucide="link"></i> On-Chain Radar <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
          <div class="oc-section">
            <div class="oc-subtitle">Open Interest</div>
            <div id="oc-oi" class="oc-oi-grid">
              <div class="skeleton-loader"><div class="skeleton skeleton-line"></div></div>
            </div>
          </div>
          <div class="oc-section">
            <div class="oc-subtitle">BTC Mempool Fees (sat/vB)</div>
            <div id="oc-mempool" class="oc-fees-row">
              <span class="oc-fee-item"><span class="oc-fee-label">‚ö°</span><span class="oc-fee-val" id="oc-fee-fast">‚Äî</span></span>
              <span class="oc-fee-item"><span class="oc-fee-label">30m</span><span class="oc-fee-val" id="oc-fee-30m">‚Äî</span></span>
              <span class="oc-fee-item"><span class="oc-fee-label">1h</span><span class="oc-fee-val" id="oc-fee-1h">‚Äî</span></span>
              <span class="oc-fee-item"><span class="oc-fee-label">üê¢</span><span class="oc-fee-val" id="oc-fee-eco">‚Äî</span></span>
            </div>
          </div>
          <div class="oc-section">
            <div class="oc-subtitle">Network Hashrate</div>
            <div id="oc-hashrate" class="oc-hashrate" style="font-family:var(--font-mono);font-size:1.1rem;font-weight:700;color:var(--neon-cyan);">‚Äî</div>
          </div>
        </div>
      </div>

      <div class="glass-panel" id="news-section" style="flex: 1; min-height: 200px;">
        <div class="panel-title" data-i18n="live_wire"><i data-lucide="rss"></i> Live Wire <i data-lucide="chevron-down" class="collapse-icon" style="width:14px;height:14px;"></i></div>
        <div class="panel-body">
        <div id="news-feed" style="overflow-y:auto; max-height:400px; font-size:0.8rem;">
          <div class="skeleton-loader"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line medium"></div><div class="skeleton skeleton-line short"></div><div class="skeleton skeleton-line"></div></div>
        </div>
        </div>
      </div>
    </div>

  </main>

  <!-- Briefing Panel (Floating Bottom) -->
  <div id="briefing-panel" class="briefing-panel" style="display:none;">
    <div class="briefing-header">
      <div class="briefing-badge">BRIEFING</div>
      <span id="briefing-title" class="briefing-title">‚Äî</span>
      <span id="briefing-time" class="briefing-time"></span>
      <button id="briefing-close" class="briefing-close"><i data-lucide="x" style="width:14px;height:14px;"></i></button>
    </div>
    <div id="briefing-content" class="briefing-content"></div>
  </div>

  <!-- Ask Ryzm Chat Float Button -->
  <button id="chat-float-btn" class="chat-float-btn" title="Ask Ryzm">
    <i data-lucide="message-circle"></i>
  </button>

  <!-- Chat Overlay -->
  <div id="chat-overlay" class="chat-overlay">
    <div class="chat-header">
      <span data-i18n-text="ask_ryzm"><i data-lucide="bot"></i> Ask Ryzm</span>
      <button id="chat-close" class="chat-close-btn">
        <i data-lucide="x"></i>
      </button>
    </div>
    <div id="chat-messages" class="chat-messages"></div>
    <div class="chat-input-container">
      <input type="text" id="chat-input" placeholder="Ask anything about the market..." />
      <button id="chat-send">
        <i data-lucide="send"></i>
      </button>
    </div>
  </div>

  <!-- Ryzm Chart Modal (price card click) -->
  <div id="tv-modal" class="tv-modal" style="display:none;">
    <div class="tv-modal-content">
      <div class="tv-modal-header">
        <span id="tv-modal-title">BTC/USDT</span>
        <button id="tv-modal-close" class="chat-close-btn"><i data-lucide="x"></i></button>
      </div>
      <div id="tv-chart-container" style="height:400px;"></div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot" id="connection-status"></span>
      <span data-i18n-text="system_online">SYSTEM ONLINE</span>
    </div>
    <div class="status-item">
      <i data-lucide="activity" style="width:12px;height:12px;"></i>
      <span id="last-update" data-i18n-prefix="last_update">Last Update: --:--</span>
    </div>
    <div class="status-item source-status" id="source-status">
      <i data-lucide="database" style="width:12px;height:12px;"></i>
      <span id="data-sources">-- Sources</span>
      <div class="source-tooltip" id="source-tooltip"></div>
    </div>
    <div class="status-item">
      <i data-lucide="zap" style="width:12px;height:12px;"></i>
      <span>Ryzm Terminal v3.3</span>
    </div>
  </div>

  <!-- JS Modules (v1.7) -->
  <script src="/static/js/chart.js?v=2.0"></script>
  <script src="/static/js/core.js?v=2.0"></script>
  <script src="/static/js/data.js?v=3.0"></script>
  <script src="/static/js/council.js?v=2.0"></script>
  <script src="/static/js/ui.js?v=3.1"></script>

  <!-- ‚ïê‚ïê‚ïê Auth Modal ‚ïê‚ïê‚ïê -->
  <div id="auth-modal" class="auth-modal" style="display:none;">
    <div class="auth-modal-inner">
      <button class="auth-close" onclick="toggleAuthModal()">&times;</button>
      <div class="auth-logo"><span class="logo-dot"></span> Ryzm_OS</div>
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login')">LOGIN</button>
        <button class="auth-tab" onclick="switchAuthTab('register')">REGISTER</button>
      </div>
      <!-- Login Form -->
      <form id="auth-login-form" class="auth-form" onsubmit="handleLogin(event)">
        <input type="email" id="login-email" placeholder="Email" required autocomplete="email" />
        <input type="password" id="login-password" placeholder="Password" required autocomplete="current-password" />
        <button type="submit" class="auth-submit">Sign In</button>
        <div id="login-error" class="auth-error"></div>
        <div style="text-align:center;margin-top:8px;">
          <a href="#" onclick="showForgotPassword(event)" style="color:var(--neon-cyan);font-size:0.72rem;text-decoration:none;">Forgot password?</a>
        </div>
      </form>
      <!-- Forgot Password Form -->
      <form id="auth-forgot-form" class="auth-form" style="display:none;" onsubmit="handleForgotPassword(event)">
        <p style="color:var(--text-secondary);font-size:0.78rem;margin:0 0 12px;">Enter your email to receive a password reset link.</p>
        <input type="email" id="forgot-email" placeholder="Email" required autocomplete="email" />
        <button type="submit" class="auth-submit">Send Reset Link</button>
        <div id="forgot-error" class="auth-error"></div>
        <div id="forgot-success" style="color:var(--neon-green);font-size:0.75rem;display:none;margin-top:6px;"></div>
        <div style="text-align:center;margin-top:8px;">
          <a href="#" onclick="backToLogin(event)" style="color:var(--neon-cyan);font-size:0.72rem;text-decoration:none;">‚Üê Back to login</a>
        </div>
      </form>
      <!-- Register Form -->
      <form id="auth-register-form" class="auth-form" style="display:none;" onsubmit="handleRegister(event)">
        <input type="text" id="reg-name" placeholder="Display Name (optional)" maxlength="50" autocomplete="name" />
        <input type="email" id="reg-email" placeholder="Email" required autocomplete="email" />
        <input type="password" id="reg-password" placeholder="Password (8+ chars)" required minlength="8" autocomplete="new-password" />
        <label class="tos-checkbox" style="display:flex;align-items:flex-start;gap:8px;margin:8px 0;font-size:0.72rem;color:var(--text-secondary);cursor:pointer;">
          <input type="checkbox" id="reg-tos" required style="margin-top:2px;accent-color:var(--neon-cyan);" />
          <span>I agree to the <a href="#" onclick="openTosModal(event)" style="color:var(--neon-cyan);text-decoration:underline;">Terms of Service</a> and understand that Ryzm Terminal is for informational purposes only, not financial advice.</span>
        </label>
        <button type="submit" class="auth-submit">Create Account</button>
        <div id="reg-error" class="auth-error"></div>
      </form>
      <!-- Logged-in state -->
      <div id="auth-profile" class="auth-profile" style="display:none;">
        <div id="email-verify-banner" style="display:none;background:rgba(244,63,94,0.15);border:1px solid rgba(244,63,94,0.3);border-radius:4px;padding:8px 12px;margin-bottom:10px;font-size:0.72rem;">
          <span style="color:var(--neon-red);">‚ö† Email not verified.</span>
          <a href="#" onclick="resendVerification(event)" style="color:var(--neon-cyan);text-decoration:underline;margin-left:4px;">Resend</a>
        </div>
        <div class="auth-profile-info">
          <div class="auth-email" id="profile-email"></div>
          <div class="auth-tier" id="profile-tier"></div>
        </div>
        <button class="auth-submit" id="btn-upgrade" style="display:none;" onclick="handleUpgrade()">
          <i data-lucide="crown" style="width:14px;height:14px;"></i> Upgrade to PRO
        </button>
        <button class="auth-submit" id="btn-open-journal" onclick="openJournalModal()" style="margin-top:6px;background:transparent;border:1px solid var(--neon-green);color:var(--neon-green);font-size:0.75rem;">
          <i data-lucide="book-open" style="width:14px;height:14px;"></i> Signal Journal
        </button>
        <button class="auth-logout" onclick="handleLogout()">Logout</button>
      </div>
    </div>
  </div>

  <script>
  /* ‚îÄ‚îÄ Auth UI Logic ‚îÄ‚îÄ */
  let _authUser = null;
  function toggleAuthModal() {
    const m = document.getElementById('auth-modal');
    m.style.display = m.style.display === 'none' ? 'flex' : 'none';
  }
  function switchAuthTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    document.getElementById('auth-login-form').style.display = tab === 'login' ? '' : 'none';
    document.getElementById('auth-register-form').style.display = tab === 'register' ? '' : 'none';
    document.getElementById('auth-forgot-form').style.display = 'none';
    document.getElementById('auth-profile').style.display = 'none';
    event.target.classList.add('active');
  }
  function showForgotPassword(e) {
    e.preventDefault();
    document.getElementById('auth-login-form').style.display = 'none';
    document.getElementById('auth-forgot-form').style.display = '';
    document.querySelectorAll('.auth-tab').forEach(t => t.style.display = 'none');
  }
  function backToLogin(e) {
    e.preventDefault();
    document.getElementById('auth-forgot-form').style.display = 'none';
    document.getElementById('auth-login-form').style.display = '';
    document.querySelectorAll('.auth-tab').forEach(t => t.style.display = '');
  }
  async function handleForgotPassword(e) {
    e.preventDefault();
    const errEl = document.getElementById('forgot-error');
    const sucEl = document.getElementById('forgot-success');
    errEl.textContent = ''; sucEl.style.display = 'none';
    try {
      const res = await fetch('/api/auth/forgot-password', {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ email: document.getElementById('forgot-email').value }),
      });
      const data = await res.json();
      sucEl.textContent = data.message || 'Reset link sent.';
      sucEl.style.display = 'block';
    } catch { errEl.textContent = 'Connection error'; }
  }
  async function resendVerification(e) {
    e.preventDefault();
    try {
      const res = await fetch('/api/auth/resend-verification', { method: 'POST', credentials: 'same-origin' });
      const data = await res.json();
      showToast('info', 'Email', data.message || 'Verification email resent.');
    } catch { showToast('error', 'Error', 'Failed to resend verification.'); }
  }
  async function handleLogin(e) {
    e.preventDefault();
    const errEl = document.getElementById('login-error');
    errEl.textContent = '';
    try {
      const res = await fetch('/api/auth/login', {
        method: 'POST', headers: {'Content-Type':'application/json'}, credentials: 'same-origin',
        body: JSON.stringify({ email: document.getElementById('login-email').value, password: document.getElementById('login-password').value }),
      });
      const data = await res.json();
      if (!res.ok) { errEl.textContent = data.detail || 'Login failed'; return; }
      localStorage.setItem('ryzm_token', data.token);
      _authUser = data;
      updateAuthUI(data);
      showToast('success', 'Welcome', `Logged in as ${data.email}`);
    } catch (err) { errEl.textContent = 'Connection error'; }
  }
  async function handleRegister(e) {
    e.preventDefault();
    const errEl = document.getElementById('reg-error');
    errEl.textContent = '';
    const tosChecked = document.getElementById('reg-tos').checked;
    if (!tosChecked) { errEl.textContent = 'You must accept the Terms of Service.'; return; }
    try {
      const res = await fetch('/api/auth/register', {
        method: 'POST', headers: {'Content-Type':'application/json'}, credentials: 'same-origin',
        body: JSON.stringify({
          email: document.getElementById('reg-email').value,
          password: document.getElementById('reg-password').value,
          display_name: document.getElementById('reg-name').value,
        }),
      });
      const data = await res.json();
      if (!res.ok) { errEl.textContent = data.detail || 'Registration failed'; return; }
      localStorage.setItem('ryzm_token', data.token);
      _authUser = data;
      updateAuthUI(data);
      showToast('success', 'Account Created', data.message || 'Welcome to Ryzm Terminal!');
    } catch (err) { errEl.textContent = 'Connection error'; }
  }
  async function handleLogout() {
    await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' });
    localStorage.removeItem('ryzm_token');
    _authUser = null;
    updateAuthUI(null);
    toggleAuthModal();
    showToast('info', 'Logged Out', 'Session ended.');
  }
  async function handleUpgrade() {
    try {
      const res = await fetch('/api/payments/create-checkout', { method: 'POST', credentials: 'same-origin' });
      const data = await res.json();
      if (data.checkout_url) window.location.href = data.checkout_url;
      else showToast('warning', 'Payment', data.detail || 'Stripe not configured yet.');
    } catch { showToast('error', 'Error', 'Payment system unavailable.'); }
  }
  function updateAuthUI(user) {
    const label = document.getElementById('auth-label');
    const badge = document.querySelector('.pro-badge');
    const loginForm = document.getElementById('auth-login-form');
    const regForm = document.getElementById('auth-register-form');
    const forgotForm = document.getElementById('auth-forgot-form');
    const profile = document.getElementById('auth-profile');
    const planBadge = document.getElementById('header-plan-badge');
    const verifyBanner = document.getElementById('email-verify-banner');
    if (user && user.email) {
      label.textContent = user.display_name || user.email.split('@')[0];
      if (user.tier === 'pro' && badge) badge.style.display = 'inline-block';
      loginForm.style.display = 'none';
      regForm.style.display = 'none';
      forgotForm.style.display = 'none';
      profile.style.display = '';
      document.getElementById('profile-email').textContent = user.email;
      document.getElementById('profile-tier').textContent = user.tier === 'pro' ? '‚≠ê PRO' : 'FREE';
      document.getElementById('profile-tier').className = 'auth-tier tier-' + user.tier;
      document.getElementById('btn-upgrade').style.display = user.tier === 'pro' ? 'none' : '';
      document.querySelectorAll('.auth-tab').forEach(t => t.style.display = 'none');
      // Email verification banner
      if (verifyBanner) {
        verifyBanner.style.display = user.email_verified === false ? 'block' : 'none';
      }
      // Header plan badge
      if (planBadge) {
        planBadge.style.display = 'inline-block';
        planBadge.textContent = user.tier === 'pro' ? '‚≠ê PRO' : 'FREE';
        planBadge.style.background = user.tier === 'pro' ? 'rgba(6,182,212,0.3)' : 'rgba(255,255,255,0.08)';
        planBadge.style.color = user.tier === 'pro' ? 'var(--neon-cyan)' : 'var(--text-muted)';
      }
    } else {
      label.textContent = 'Login';
      if (badge) badge.style.display = 'none';
      loginForm.style.display = '';
      regForm.style.display = 'none';
      forgotForm.style.display = 'none';
      profile.style.display = 'none';
      document.querySelectorAll('.auth-tab').forEach(t => t.style.display = '');
      if (planBadge) planBadge.style.display = 'none';
      if (verifyBanner) verifyBanner.style.display = 'none';
    }
  }
  // Check auth on load
  (async function checkAuth() {
    try {
      const r = await fetch('/api/auth/profile', { credentials: 'same-origin' });
      if (r.ok) { _authUser = await r.json(); updateAuthUI(_authUser); }
      else updateAuthUI(null);
    } catch { updateAuthUI(null); }
  })();
  // Handle email verification from URL params
  (function checkVerifyParam() {
    const params = new URLSearchParams(window.location.search);
    const token = params.get('verify_token') || params.get('token');
    const path = window.location.pathname;
    if (path === '/verify-email' && token) {
      fetch(`/api/auth/verify-email?token=${encodeURIComponent(token)}`)
        .then(r => r.json())
        .then(data => {
          if (data.status === 'verified') {
            showToast('success', '‚úì Verified', 'Email verified successfully!');
            if (_authUser) { _authUser.email_verified = true; updateAuthUI(_authUser); }
          } else {
            showToast('error', 'Error', data.detail || 'Verification failed.');
          }
          window.history.replaceState({}, '', '/');
        })
        .catch(() => showToast('error', 'Error', 'Verification failed.'));
    }
    // Handle password reset from URL
    if (path === '/reset-password' && token) {
      openResetPasswordModal(token);
      window.history.replaceState({}, '', '/');
    }
  })();
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       UPGRADE MODAL (Plan Gate)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="upgrade-modal" class="upgrade-modal" style="display:none;">
    <div class="upgrade-modal-inner">
      <button class="upgrade-close" onclick="closeUpgradeModal()">&times;</button>
      <div class="upgrade-logo">‚ö° Ryzm Pro</div>
      <p id="upgrade-context-msg" class="upgrade-context" style="color:var(--text-secondary);margin:8px 0 16px;font-size:0.82rem;"></p>
      <table class="upgrade-compare">
        <thead>
          <tr><th></th><th>Free</th><th style="color:var(--neon-cyan);">Pro</th></tr>
        </thead>
        <tbody>
          <tr><td>AI Council</td><td>10/day</td><td>Unlimited</td></tr>
          <tr><td>Trade Validator</td><td>3/day</td><td>Unlimited</td></tr>
          <tr><td>Ask Ryzm Chat</td><td>20/day</td><td>Unlimited</td></tr>
          <tr><td>Price Alerts</td><td>5</td><td>100</td></tr>
          <tr><td>Council History</td><td>7 days</td><td>90 days + CSV</td></tr>
          <tr><td>Accuracy Tracker</td><td>Basic</td><td>Multi-horizon</td></tr>
        </tbody>
      </table>
      <button class="upgrade-cta" id="upgrade-cta-btn" onclick="handleUpgradeFromModal()">
        üöÄ Upgrade to Pro
      </button>
      <div style="font-size:0.65rem; color:var(--text-tertiary); margin-top:8px;">Cancel anytime ¬∑ Stripe secure checkout</div>
    </div>
  </div>

  <script>
  /* ‚îÄ‚îÄ Upgrade Modal logic ‚îÄ‚îÄ */
  const _upgradeMessages = {
    council_limit:   'You\'ve used all free AI Council runs today.',
    validator_limit: 'Daily free validation limit reached.',
    chat_limit:      'Daily free chat messages exhausted.',
    alerts_limit:    'Free plan alert limit reached.',
    general:         'Unlock unlimited access to all Ryzm features.'
  };
  function openUpgradeModal(context) {
    const modal = document.getElementById('upgrade-modal');
    if (!modal) return;
    const msg = document.getElementById('upgrade-context-msg');
    if (msg) msg.textContent = _upgradeMessages[context] || _upgradeMessages.general;
    modal.style.display = 'flex';
  }
  function closeUpgradeModal() {
    const m = document.getElementById('upgrade-modal'); if (m) m.style.display = 'none';
  }
  async function handleUpgradeFromModal() {
    try {
      const r = await fetch('/api/auth/profile', { credentials: 'same-origin' });
      if (!r.ok) { closeUpgradeModal(); toggleAuthModal(); return; } // not logged in ‚Üí show login
      const res = await fetch('/api/payments/create-checkout', { method: 'POST', credentials: 'same-origin' });
      const data = await res.json();
      if (data.checkout_url) window.location.href = data.checkout_url;
      else showToast('warning', 'Payment', data.detail || 'Stripe not configured.');
    } catch { showToast('error', 'Error', 'Payment unavailable.'); }
  }
  // Close on backdrop click
  document.getElementById('upgrade-modal')?.addEventListener('click', e => {
    if (e.target.id === 'upgrade-modal') closeUpgradeModal();
  });
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIGNAL JOURNAL MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="journal-modal" class="upgrade-modal" style="display:none;">
    <div class="upgrade-modal-inner" style="max-width:700px;max-height:85vh;overflow-y:auto;">
      <button class="upgrade-close" onclick="closeJournalModal()">&times;</button>
      <div class="upgrade-logo">üìî Signal Journal</div>
      <!-- Journal Stats -->
      <div id="journal-stats" style="display:flex;gap:12px;margin:10px 0;font-size:0.72rem;color:var(--text-secondary);justify-content:center;flex-wrap:wrap;">
        <span>Total: <strong id="j-stat-total">0</strong></span>
        <span style="color:var(--neon-green);">W: <strong id="j-stat-wins">0</strong></span>
        <span style="color:var(--neon-red);">L: <strong id="j-stat-losses">0</strong></span>
        <span>WR: <strong id="j-stat-wr">‚Äî</strong></span>
        <span>Open: <strong id="j-stat-open">0</strong></span>
      </div>
      <!-- Journal Entry List -->
      <div id="journal-entries" style="margin-top:12px;"></div>
      <div id="journal-empty" style="text-align:center;color:var(--text-muted);font-size:0.78rem;padding:30px 0;">
        No journal entries yet. Run an AI Council analysis and click "Save to Journal".
      </div>
    </div>
  </div>

  <!-- Journal Save Form (overlay when saving from council) -->
  <div id="journal-save-modal" class="upgrade-modal" style="display:none;">
    <div class="upgrade-modal-inner" style="max-width:480px;">
      <button class="upgrade-close" onclick="closeJournalSaveModal()">&times;</button>
      <div class="upgrade-logo">üìù Save to Journal</div>
      <form id="journal-save-form" onsubmit="submitJournalEntry(event)" style="display:flex;flex-direction:column;gap:10px;margin-top:12px;">
        <div style="display:flex;gap:8px;">
          <select id="j-position" class="val-input" style="flex:1;">
            <option value="">‚Äî Position ‚Äî</option>
            <option value="LONG">LONG</option>
            <option value="SHORT">SHORT</option>
          </select>
          <input type="number" id="j-entry-price" class="val-input" placeholder="Entry $" step="0.01" min="0" style="flex:1;" />
        </div>
        <div style="display:flex;gap:8px;">
          <input type="number" id="j-stop-loss" class="val-input" placeholder="Stop Loss $" step="0.01" min="0" style="flex:1;" />
          <input type="number" id="j-take-profit" class="val-input" placeholder="Take Profit $" step="0.01" min="0" style="flex:1;" />
        </div>
        <textarea id="j-note" placeholder="Your notes & thesis..." maxlength="2000"
          style="width:100%;height:80px;background:var(--bg-dark);color:var(--text-primary);border:1px solid var(--border-dim);border-radius:4px;padding:8px;font-size:0.78rem;resize:vertical;font-family:inherit;"></textarea>
        <input type="text" id="j-tags" class="val-input" placeholder="Tags (comma-separated)" maxlength="200" />
        <button type="submit" class="auth-submit" style="background:var(--neon-green);color:#000;">
          <i data-lucide="save" style="width:14px;height:14px;"></i> Save Entry
        </button>
        <div id="j-save-error" class="auth-error"></div>
      </form>
    </div>
  </div>

  <!-- Journal Outcome Update Modal -->
  <div id="journal-outcome-modal" class="upgrade-modal" style="display:none;">
    <div class="upgrade-modal-inner" style="max-width:400px;">
      <button class="upgrade-close" onclick="closeJournalOutcomeModal()">&times;</button>
      <div class="upgrade-logo">üìä Record Outcome</div>
      <form id="journal-outcome-form" onsubmit="submitJournalOutcome(event)" style="display:flex;flex-direction:column;gap:10px;margin-top:12px;">
        <input type="hidden" id="jo-entry-id" />
        <select id="jo-outcome" class="val-input" required>
          <option value="">‚Äî Outcome ‚Äî</option>
          <option value="WIN">‚úÖ WIN</option>
          <option value="LOSS">‚ùå LOSS</option>
          <option value="BREAKEVEN">‚ûñ BREAKEVEN</option>
        </select>
        <input type="number" id="jo-price" class="val-input" placeholder="Exit Price $" step="0.01" min="0" />
        <textarea id="jo-note" placeholder="Outcome notes / lessons learned..." maxlength="2000"
          style="width:100%;height:60px;background:var(--bg-dark);color:var(--text-primary);border:1px solid var(--border-dim);border-radius:4px;padding:8px;font-size:0.78rem;resize:vertical;font-family:inherit;"></textarea>
        <button type="submit" class="auth-submit" style="background:var(--neon-cyan);color:#000;">Record Outcome</button>
      </form>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PASSWORD RESET MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="reset-password-modal" class="upgrade-modal" style="display:none;">
    <div class="upgrade-modal-inner" style="max-width:400px;">
      <button class="upgrade-close" onclick="closeResetPasswordModal()">&times;</button>
      <div class="upgrade-logo">üîê Reset Password</div>
      <form id="reset-pw-form" onsubmit="handleResetPassword(event)" style="display:flex;flex-direction:column;gap:10px;margin-top:12px;">
        <input type="hidden" id="reset-token" />
        <input type="password" id="reset-new-pw" placeholder="New Password (8+ chars)" required minlength="8"
          class="val-input" autocomplete="new-password" />
        <input type="password" id="reset-confirm-pw" placeholder="Confirm Password" required minlength="8"
          class="val-input" autocomplete="new-password" />
        <button type="submit" class="auth-submit">Set New Password</button>
        <div id="reset-error" class="auth-error"></div>
        <div id="reset-success" style="color:var(--neon-green);font-size:0.75rem;display:none;"></div>
      </form>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TERMS OF SERVICE MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="tos-modal" class="upgrade-modal" style="display:none;">
    <div class="upgrade-modal-inner" style="max-width:600px;max-height:80vh;overflow-y:auto;">
      <button class="upgrade-close" onclick="closeTosModal()">&times;</button>
      <div class="upgrade-logo">üìú Terms of Service</div>
      <div style="font-size:0.75rem;color:var(--text-secondary);line-height:1.7;margin-top:12px;text-align:left;">
        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">1. Information Only</h3>
        <p>Ryzm Terminal provides AI-generated market analysis for <strong>informational and educational purposes only</strong>. Nothing on this platform constitutes financial, investment, trading, or any other kind of professional advice.</p>

        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">2. No Investment Advice</h3>
        <p>All AI council opinions, trade validations, risk scores, and chat responses are generated by machine learning models. They may be <strong>inaccurate, outdated, or misleading</strong>. You should not rely on them to make investment decisions.</p>

        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">3. Risk Disclosure</h3>
        <p>Cryptocurrency trading involves <strong>substantial risk of loss</strong> and is not suitable for every investor. Past performance, including AI prediction accuracy, is not indicative of future results. You could lose some or all of your capital.</p>

        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">4. No Liability</h3>
        <p>Ryzm Terminal, its creators, and affiliates shall not be held liable for any losses, damages, or claims arising from your use of this platform or reliance on its AI-generated content.</p>

        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">5. User Responsibilities</h3>
        <p>You are solely responsible for your trading decisions. Always conduct your own research (DYOR) and consult with a qualified financial advisor before making investment decisions.</p>

        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">6. Data & Privacy</h3>
        <p>We collect minimal personal data (email, usage analytics). Your journal entries and trading data are stored securely and never shared with third parties. You can request data deletion at any time.</p>

        <h3 style="color:var(--neon-cyan);font-size:0.85rem;">7. Service Changes</h3>
        <p>We reserve the right to modify, suspend, or discontinue the service at any time. Pro subscription terms are governed by our payment processor (Stripe).</p>

        <p style="margin-top:16px;font-style:italic;color:var(--text-muted);">Version 1.0 ‚Äî Last updated: 2025</p>
      </div>
      <button onclick="closeTosModal()" class="auth-submit" style="margin-top:12px;">Close</button>
    </div>
  </div>

  <script>
  /* ‚îÄ‚îÄ Journal Logic ‚îÄ‚îÄ */
  function openJournalModal() {
    document.getElementById('journal-modal').style.display = 'flex';
    loadJournalEntries();
  }
  function closeJournalModal() { document.getElementById('journal-modal').style.display = 'none'; }
  function openJournalSaveModal() {
    if (!_authUser) { toggleAuthModal(); return; }
    document.getElementById('journal-save-modal').style.display = 'flex';
    lucide.createIcons();
  }
  function closeJournalSaveModal() { document.getElementById('journal-save-modal').style.display = 'none'; }
  function closeJournalOutcomeModal() { document.getElementById('journal-outcome-modal').style.display = 'none'; }

  // Save to Journal button
  document.getElementById('btn-save-journal')?.addEventListener('click', () => {
    playSound('click');
    openJournalSaveModal();
  });

  async function submitJournalEntry(e) {
    e.preventDefault();
    const errEl = document.getElementById('j-save-error');
    errEl.textContent = '';
    const data = window._lastCouncilData || {};
    try {
      const res = await fetch('/api/journal', {
        method: 'POST', headers: {'Content-Type':'application/json'}, credentials: 'same-origin',
        body: JSON.stringify({
          council_id: 0,
          snapshot: data,
          position_type: document.getElementById('j-position').value,
          entry_price: parseFloat(document.getElementById('j-entry-price').value) || 0,
          stop_loss: parseFloat(document.getElementById('j-stop-loss').value) || 0,
          take_profit: parseFloat(document.getElementById('j-take-profit').value) || 0,
          user_note: document.getElementById('j-note').value,
          tags: document.getElementById('j-tags').value,
        }),
      });
      const result = await res.json();
      if (!res.ok) {
        if (res.status === 403 && typeof openUpgradeModal === 'function') openUpgradeModal('general');
        errEl.textContent = result.detail || 'Save failed';
        return;
      }
      showToast('success', 'üìî Saved', 'Entry saved to Signal Journal.');
      closeJournalSaveModal();
      document.getElementById('journal-save-form').reset();
    } catch { errEl.textContent = 'Connection error'; }
  }

  async function loadJournalEntries() {
    try {
      const res = await fetch('/api/journal?limit=50', { credentials: 'same-origin' });
      if (!res.ok) return;
      const data = await res.json();
      const container = document.getElementById('journal-entries');
      const empty = document.getElementById('journal-empty');
      // Stats
      const s = data.stats || {};
      document.getElementById('j-stat-total').textContent = s.total || 0;
      document.getElementById('j-stat-wins').textContent = s.wins || 0;
      document.getElementById('j-stat-losses').textContent = s.losses || 0;
      document.getElementById('j-stat-wr').textContent = s.win_rate != null ? s.win_rate + '%' : '‚Äî';
      document.getElementById('j-stat-open').textContent = s.open || 0;

      if (!data.entries || data.entries.length === 0) {
        container.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      container.innerHTML = data.entries.map(e => {
        const snap = e.snapshot || {};
        const vibe = snap.vibe?.status || '‚Äî';
        const score = snap.consensus_score ?? '‚Äî';
        const pred = snap.prediction || '‚Äî';
        const outcomeColor = e.outcome === 'WIN' ? 'var(--neon-green)' : e.outcome === 'LOSS' ? 'var(--neon-red)' : 'var(--text-muted)';
        const outcomeLabel = e.outcome || 'OPEN';
        const posLabel = e.position_type ? `${e.position_type} @ $${e.entry_price.toLocaleString()}` : '';
        const slTp = (e.stop_loss || e.take_profit) ? `SL: $${(e.stop_loss||0).toLocaleString()} / TP: $${(e.take_profit||0).toLocaleString()}` : '';
        return `
          <div class="journal-entry" style="background:var(--bg-panel);border:1px solid var(--border-dim);border-radius:6px;padding:12px;margin-bottom:8px;font-size:0.75rem;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <span style="color:var(--text-muted);">${escapeHtml(e.created_at_utc || '')}</span>
              <span style="color:${outcomeColor};font-weight:700;font-size:0.8rem;">${escapeHtml(outcomeLabel)}</span>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:4px;">
              <span style="color:var(--neon-cyan);">Score: ${escapeHtml(String(score))}</span>
              <span>Pred: ${escapeHtml(pred)}</span>
              <span>Vibe: ${escapeHtml(vibe)}</span>
              ${posLabel ? `<span style="color:var(--neon-magenta);">${escapeHtml(posLabel)}</span>` : ''}
            </div>
            ${slTp ? `<div style="color:var(--text-muted);font-size:0.7rem;">${escapeHtml(slTp)}</div>` : ''}
            ${e.user_note ? `<div style="margin-top:4px;color:var(--text-secondary);font-style:italic;">"${escapeHtml(e.user_note)}"</div>` : ''}
            ${e.tags ? `<div style="margin-top:4px;">${e.tags.split(',').map(t => `<span style="background:rgba(6,182,212,0.15);color:var(--neon-cyan);padding:1px 6px;border-radius:3px;font-size:0.65rem;margin-right:4px;">${escapeHtml(t.trim())}</span>`).join('')}</div>` : ''}
            <div style="margin-top:6px;display:flex;gap:6px;">
              ${!e.outcome ? `<button onclick="openOutcomeModal(${e.id})" style="background:var(--neon-cyan);color:#000;border:none;padding:3px 10px;border-radius:3px;font-size:0.68rem;cursor:pointer;">Record Outcome</button>` : ''}
              ${e.outcome_note ? `<span style="color:var(--text-muted);font-size:0.68rem;">üìù ${escapeHtml(e.outcome_note)}</span>` : ''}
              <button onclick="deleteJournalEntry(${e.id})" style="background:transparent;color:var(--neon-red);border:1px solid rgba(244,63,94,0.3);padding:3px 8px;border-radius:3px;font-size:0.65rem;cursor:pointer;margin-left:auto;">Delete</button>
            </div>
          </div>
        `;
      }).join('');
    } catch { /* silent */ }
  }

  function openOutcomeModal(entryId) {
    document.getElementById('jo-entry-id').value = entryId;
    document.getElementById('journal-outcome-modal').style.display = 'flex';
  }

  async function submitJournalOutcome(e) {
    e.preventDefault();
    const entryId = document.getElementById('jo-entry-id').value;
    try {
      const res = await fetch(`/api/journal/${entryId}`, {
        method: 'PUT', headers: {'Content-Type':'application/json'}, credentials: 'same-origin',
        body: JSON.stringify({
          outcome: document.getElementById('jo-outcome').value,
          outcome_price: parseFloat(document.getElementById('jo-price').value) || 0,
          outcome_note: document.getElementById('jo-note').value,
        }),
      });
      if (!res.ok) { showToast('error', 'Error', 'Failed to update.'); return; }
      showToast('success', 'üìä Updated', 'Outcome recorded.');
      closeJournalOutcomeModal();
      document.getElementById('journal-outcome-form').reset();
      loadJournalEntries();
    } catch { showToast('error', 'Error', 'Connection error.'); }
  }

  async function deleteJournalEntry(entryId) {
    if (!confirm('Delete this journal entry?')) return;
    try {
      const res = await fetch(`/api/journal/${entryId}`, { method: 'DELETE', credentials: 'same-origin' });
      if (res.ok) { showToast('info', 'Deleted', 'Entry removed.'); loadJournalEntries(); }
    } catch { /* silent */ }
  }

  /* ‚îÄ‚îÄ Reset Password Modal ‚îÄ‚îÄ */
  function openResetPasswordModal(token) {
    document.getElementById('reset-token').value = token;
    document.getElementById('reset-password-modal').style.display = 'flex';
  }
  function closeResetPasswordModal() { document.getElementById('reset-password-modal').style.display = 'none'; }
  async function handleResetPassword(e) {
    e.preventDefault();
    const errEl = document.getElementById('reset-error');
    const sucEl = document.getElementById('reset-success');
    errEl.textContent = ''; sucEl.style.display = 'none';
    const pw = document.getElementById('reset-new-pw').value;
    const confirm = document.getElementById('reset-confirm-pw').value;
    if (pw !== confirm) { errEl.textContent = 'Passwords do not match.'; return; }
    try {
      const res = await fetch('/api/auth/reset-password', {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ token: document.getElementById('reset-token').value, new_password: pw }),
      });
      const data = await res.json();
      if (!res.ok) { errEl.textContent = data.detail || 'Reset failed.'; return; }
      sucEl.textContent = data.message || 'Password reset! You can now login.';
      sucEl.style.display = 'block';
      setTimeout(() => { closeResetPasswordModal(); toggleAuthModal(); }, 2000);
    } catch { errEl.textContent = 'Connection error.'; }
  }

  /* ‚îÄ‚îÄ ToS Modal ‚îÄ‚îÄ */
  function openTosModal(e) { if (e) e.preventDefault(); document.getElementById('tos-modal').style.display = 'flex'; }
  function closeTosModal() { document.getElementById('tos-modal').style.display = 'none'; }

  /* ‚îÄ‚îÄ Modal backdrop close ‚îÄ‚îÄ */
  ['journal-modal','journal-save-modal','journal-outcome-modal','reset-password-modal','tos-modal'].forEach(id => {
    document.getElementById(id)?.addEventListener('click', e => {
      if (e.target.id === id) e.target.style.display = 'none';
    });
  });
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       DISCLAIMER FOOTER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="disclaimer-bar" style="position:fixed;bottom:0;left:0;right:0;z-index:999;background:rgba(10,10,15,0.95);border-top:1px solid rgba(244,63,94,0.3);padding:4px 16px;font-size:0.6rem;color:var(--text-muted);text-align:center;pointer-events:none;">
    ‚ö†Ô∏è Ryzm Terminal provides AI-generated analysis for informational purposes only. Not financial advice. Trading crypto involves substantial risk of loss. DYOR.
  </div>

</body>

</html>